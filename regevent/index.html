<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVENT REGISTRATION</title>
    <link rel="icon" href="favicon.png" type="image/x-icon">
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    
    <style>
        /* --- CONFIG & THEME --- */
        :root {
            --mw-bg: #0a0a0a;
            --mw-panel: #141414;
            --mw-text: #cccccc;
            --mw-accent: #789f55; 
            --mw-flash: #ffaa00;  
            --mw-border: #333333;
        }

        * { box-sizing: border-box; }
        
        body {
            background-color: var(--mw-bg);
            color: var(--mw-text);
            font-family: 'Roboto', sans-serif;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; padding: 20px;
            overflow-x: hidden; position: relative;
        }

        /* --- VISUAL EFFECTS --- */
        body::before { 
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 1px, transparent 1px, transparent 2px);
            pointer-events: none; z-index: 1; animation: scanlineMove 10s linear infinite; opacity: 0.3;
        }
        
        /* --- CONTAINER --- */
        .container {
            background: var(--mw-panel);
            width: 100%; max-width: 600px;
            padding: 35px;
            border-top: 4px solid var(--mw-accent);
            border-bottom: 1px solid var(--mw-border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative; z-index: 10;
        }
        .container.deploying { animation: rumble 0.5s cubic-bezier(.36,.07,.19,.97) both; }

        /* --- ANIMATION --- */
        @keyframes scanlineMove { from { background-position: 0 0; } to { background-position: 0 100%; } }
        @keyframes rumble {
            10%, 90% { transform: translate3d(-3px, 0, 0) rotate(-1deg); }
            20%, 80% { transform: translate3d(5px, 0, 0) rotate(1deg); }
            30%, 50%, 70% { transform: translate3d(-6px, -2px, 0) rotate(-2deg); border-top-color: var(--mw-flash); }
            40%, 60% { transform: translate3d(6px, 2px, 0) rotate(2deg); }
        }

        /* --- FORM ELEMENTS --- */
        h2 { 
            text-align: center; margin-bottom: 25px; 
            font-family: 'Roboto Condensed', sans-serif; font-weight: 700; font-size: 2rem; color: #ffffff; 
            text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid var(--mw-border); padding-bottom: 15px;
        }
        
        label { font-family: 'Roboto Condensed', sans-serif; font-size: 0.85rem; color: var(--mw-accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; display: block; font-weight: 700; }
        .form-group { margin-bottom: 20px; }
        
        /* SECTION DIVIDER */
        .form-section-title {
            color: #fff; background: rgba(255,255,255,0.05); padding: 8px 10px; margin: 25px 0 15px 0;
            font-family: 'Roboto Condensed', sans-serif; letter-spacing: 1px; font-size: 0.9rem; border-left: 3px solid var(--mw-accent);
        }

        input, select, textarea { width: 100%; padding: 14px; background: #0f0f0f; border: 1px solid var(--mw-border); border-left: 3px solid var(--mw-border); color: #fff; font-family: 'Roboto', sans-serif; font-size: 1rem; transition: 0.2s; outline: none; border-radius: 0; }
        input:focus, select:focus, textarea:focus { border-color: #555; border-left-color: var(--mw-accent); background: #1a1a1a; }
        input::placeholder { color: #555; font-style: italic; font-size: 0.9rem; }
        
        .input-guide { font-size: 0.75rem; color: #666; margin-top: 5px; font-style: italic; line-height: 1.4; display: block;}

        /* RADIO BUTTON GROUP */
        .mode-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .mode-option { flex: 1; }
        .mode-option input { display: none; }
        .mode-option label {
            background: #1a1a1a; border: 1px solid var(--mw-border); text-align: center; padding: 15px; cursor: pointer;
            transition: 0.3s; color: #666; margin-bottom: 0; display: block;
        }
        .mode-option input:checked + label {
            background: var(--mw-accent); color: #000; border-color: var(--mw-accent); box-shadow: 0 0 15px rgba(120, 159, 85, 0.3);
        }

        /* DYNAMIC FIELDS ANIMATION */
        .dynamic-field { transition: all 0.3s ease; opacity: 1; max-height: 500px; overflow: hidden; }
        .dynamic-field.hidden { opacity: 0; max-height: 0; margin: 0; padding: 0; pointer-events: none; }

        button { width: 100%; padding: 16px; border: none; background: #252525; color: #ccc; font-family: 'Roboto Condensed', sans-serif; font-weight: 700; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; transition: 0.2s; margin-top: 10px; border-left: 4px solid #444; }
        button:hover { background: var(--mw-accent); color: #fff; border-left-color: #fff; }
        button:disabled { background: #151515; color: #444; border-left-color: #222; cursor: not-allowed; }
        
        .loader { display: none; text-align: center; margin-top: 15px; font-family: 'Roboto Condensed', sans-serif; font-size: 0.9rem; color: var(--mw-accent); }
        .status-text { text-align: center; font-style: italic; color: #555; font-size: 0.9rem; margin-bottom: 20px; }

        @media (max-width: 600px) { .container { padding: 20px; } h2 { font-size: 1.6rem; } }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <h2><i class="fas fa-crosshairs"></i> EVENT DEPLOYMENT</h2>
    
    <div class="status-text" id="connectionStatus">ESTABLISHING CONNECTION TO HQ...</div>

    <form name="submit-to-google-sheet">
        
        <div class="form-group">
            <label><i class="fas fa-calendar-alt"></i> SELECT OPERATION (EVENT)</label>
            <select name="selectedEvent" id="eventSelect" required>
                <option value="">LOADING MISSIONS...</option>
            </select>
        </div>

        <label>REGISTRATION TYPE</label>
        <div class="mode-selector">
            <div class="mode-option">
                <input type="radio" name="RegType" id="modeSolo" value="SOLO" checked onchange="toggleFormMode(false)">
                <label for="modeSolo"><i class="fas fa-user"></i> SOLO</label>
            </div>
            <div class="mode-option">
                <input type="radio" name="RegType" id="modeTeam" value="TEAM" onchange="toggleFormMode(true)">
                <label for="modeTeam"><i class="fas fa-users"></i> TEAM</label>
            </div>
        </div>

        <div id="teamNameField" class="dynamic-field hidden">
            <div class="form-group">
                <label>SQUAD NAME (NAMA TIM)</label>
                <input type="text" name="TeamName" id="inputTeamName" placeholder="Contoh: FALCON ELITE">
            </div>
        </div>

        <div class="form-group">
            <label>NOMOR PERWAKILAN (WA)</label>
            <input type="number" name="NoWA" placeholder="081xxxxx" required autocomplete="off">
        </div>

        <div class="form-section-title">PLAYER 1 DATA (CAPTAIN)</div>
        <div class="form-group">
            <label>NICKNAME</label>
            <input type="text" name="P1_Nick" placeholder="In-Game Nickname" required>
        </div>
        <div class="form-group">
            <label>UID (USER ID)</label>
            <input type="number" name="P1_UID" placeholder="UID Profil" required>
        </div>
        <div class="form-group">
            <label>OPEN ID</label>
            <input type="text" name="P1_OpenID" placeholder="32 Digit Code..." required>
            <small class="input-guide">Settings -> Legal & Privacy -> PlayerID (Copy).</small>
        </div>

        <div id="player2-area" class="dynamic-field hidden">
            <div class="form-section-title">PLAYER 2 DATA (PARTNER)</div>
            <div class="form-group">
                <label>NICKNAME</label>
                <input type="text" name="P2_Nick" id="p2_nick" placeholder="Nickname Player 2">
            </div>
            <div class="form-group">
                <label>UID (USER ID)</label>
                <input type="number" name="P2_UID" id="p2_uid" placeholder="UID Player 2">
            </div>
            <div class="form-group">
                <label>OPEN ID</label>
                <input type="text" name="P2_OpenID" id="p2_openid" placeholder="OpenID Player 2">
            </div>
        </div>

        <button type="submit" id="btnKirim" disabled>INITIALIZING...</button>
        <div class="loader" id="loader"><i class="fas fa-satellite-dish fa-spin"></i> TRANSMITTING DATA...</div>
    </form>
</div>

<script>
    // MASUKKAN URL WEB APP GOOGLE SCRIPT KAMU DISINI
    const scriptURL = 'https://script.google.com/macros/s/AKfycbw-WZfI_C6ogfr8SK0Ohb5gLzhG5EylyN-ybJFEIfK9S-0MGZey7sbIrnw4GuWOetqY/exec';

    const eventSelect = document.getElementById('eventSelect');
    const statusText = document.getElementById('connectionStatus');
    const btnKirim = document.getElementById('btnKirim');
    const teamNameField = document.getElementById('teamNameField');
    const inputTeamName = document.getElementById('inputTeamName');
    const player2Area = document.getElementById('player2-area');
    
    // Elements Player 2 untuk Toggle Required
    const p2Inputs = [
        document.getElementById('p2_nick'), 
        document.getElementById('p2_uid'), 
        document.getElementById('p2_openid')
    ];

    // --- 1. FETCH EVENTS DARI GOOGLE SHEET SAAT LOAD ---
    // Ini rahasianya: Script akan minta daftar event ke Spreadsheet
    function loadEvents() {
        fetch(scriptURL + '?action=getEvents')
            .then(response => response.json())
            .then(events => {
                eventSelect.innerHTML = '<option value="">[ SELECT MISSION TARGET ]</option>';
                
                if (events.length === 0) {
                    let opt = document.createElement('option');
                    opt.text = "NO ACTIVE EVENTS";
                    eventSelect.appendChild(opt);
                    statusText.innerText = "NO MISSIONS AVAILABLE.";
                } else {
                    events.forEach(evt => {
                        let opt = document.createElement('option');
                        opt.value = evt;
                        opt.text = evt;
                        eventSelect.appendChild(opt);
                    });
                    statusText.innerText = "SYSTEM ONLINE. READY FOR INPUT.";
                    statusText.style.color = "#789f55";
                    btnKirim.disabled = false;
                    btnKirim.innerHTML = "CONFIRM REGISTRATION";
                }
            })
            .catch(error => {
                console.error('Error loading events:', error);
                statusText.innerText = "CONNECTION FAILED. REFRESH PAGE.";
                statusText.style.color = "red";
                eventSelect.innerHTML = '<option>ERROR LOADING EVENTS</option>';
            });
    }

    // Jalankan fungsi load saat halaman dibuka
    loadEvents();

    // --- 2. LOGIC TOGGLE SOLO / TEAM ---
    function toggleFormMode(isTeam) {
        if (isTeam) {
            // Tampilkan Field Team & P2
            teamNameField.classList.remove('hidden');
            player2Area.classList.remove('hidden');
            
            // Set Required
            inputTeamName.setAttribute('required', 'true');
            p2Inputs.forEach(el => el.setAttribute('required', 'true'));
        } else {
            // Sembunyikan
            teamNameField.classList.add('hidden');
            player2Area.classList.add('hidden');
            
            // Hapus Required & Bersihkan Input
            inputTeamName.removeAttribute('required');
            inputTeamName.value = "";
            
            p2Inputs.forEach(el => {
                el.removeAttribute('required');
                el.value = "";
            });
        }
    }

    // --- 3. SUBMIT DATA ---
    const form = document.forms['submit-to-google-sheet'];
    const mainContainer = document.getElementById('mainContainer');
    const loader = document.getElementById('loader');

    form.addEventListener('submit', e => {
        e.preventDefault();
        
        mainContainer.classList.add('deploying');
        setTimeout(() => mainContainer.classList.remove('deploying'), 500);

        btnKirim.disabled = true;
        btnKirim.innerHTML = "PROCESSING...";
        loader.style.display = "block";

        fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => {
                alert("✅ REGISTRATION CONFIRMED!\nGood luck, Soldier.");
                form.reset();
                toggleFormMode(false); // Reset ke mode solo
                loader.style.display = "none";
                btnKirim.disabled = false;
                btnKirim.innerHTML = "CONFIRM REGISTRATION";
            })
            .catch(error => {
                alert("❌ ERROR: Connection Lost.");
                loader.style.display = "none";
                btnKirim.disabled = false;
            });
    });
</script>

</body>
</html>
