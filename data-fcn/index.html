<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATTENDANCE - FalconIDN Clan</title>
    <link rel="icon" href="../favicon.png" type="image/x-icon">
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    
    <style>
        /* --- RESET & BASIC SETUP --- */
        * { box-sizing: border-box; }
        body {
            background-color: #050505;
            background-image: 
                linear-gradient(rgba(0, 255, 204, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 204, 0.03) 1px, transparent 1px);
            background-size: 30px 30px; /* Grid effect */
            color: #e0e0e0;
            font-family: 'Rajdhani', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        /* --- CONTAINER STYLE --- */
        .container {
            background: rgba(16, 20, 24, 0.95);
            width: 100%;
            max-width: 500px;
            padding: 40px 30px;
            border: 1px solid #333;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.1);
            
            /* Angular Corners (Clip-path) untuk kesan Sci-Fi */
            clip-path: polygon(
                20px 0, 100% 0, 
                100% calc(100% - 20px), calc(100% - 20px) 100%, 
                0 100%, 0 20px
            );
        }

        /* Decorative Borders */
        .container::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100px; height: 2px;
            background: #00ffcc; box-shadow: 0 0 10px #00ffcc;
        }
        .container::after {
            content: ''; position: absolute; bottom: 0; right: 0; width: 100px; height: 2px;
            background: #00ffcc; box-shadow: 0 0 10px #00ffcc;
        }

        /* --- TYPOGRAPHY --- */
        h2 { 
            text-align: center; 
            margin-bottom: 30px; 
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
        }
        h2 i { color: #00ffcc; margin-right: 10px; }

        label {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            color: #00ffcc;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            display: block;
        }

        /* --- FORMS --- */
        .form-group { margin-bottom: 20px; }
        
        input, select, textarea {
            width: 100%;
            padding: 15px;
            background: #0b0c10;
            border: 1px solid #333;
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            transition: 0.3s;
            outline: none;
        }
        
        /* Sudut input dipotong sedikit */
        input, select, textarea { clip-path: polygon(0 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%); }

        input:focus, select:focus, textarea:focus {
            border-color: #00ffcc;
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.2) inset;
        }

        input::placeholder, textarea::placeholder { color: #555; }
        textarea { resize: none; height: 100px; }

        /* --- BUTTONS --- */
        button {
            width: 100%;
            padding: 18px;
            border: none;
            background: #00ffcc;
            color: #000;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: 0.3s;
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }

        button:hover {
            background: #fff;
            box-shadow: 0 0 20px #00ffcc;
            transform: translateY(-2px);
        }

        button:disabled { background: #333; color: #777; cursor: not-allowed; box-shadow: none; }

        /* --- USER SELECT BOX --- */
        .user-select-container {
            border: 1px solid #333;
            background: rgba(0, 255, 204, 0.05);
            padding: 20px;
            margin-bottom: 25px;
            position: relative;
        }
        .user-select-container::before {
            content: 'DATABASE ACCESS';
            position: absolute;
            top: -10px;
            left: 10px;
            background: #050505;
            padding: 0 5px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            color: #777;
        }

        /* --- LOADER --- */
        .loader { 
            display: none; 
            text-align: center; 
            margin-top: 15px; 
            font-family: 'Orbitron', sans-serif; 
            font-size: 0.8rem; 
            color: #00ffcc; 
            text-transform: uppercase;
            animation: blink 1s infinite;
        }

        @keyframes blink { 50% { opacity: 0.5; } }

        /* --- FOOTER LINK --- */
        .back-link {
            text-align: center; margin-top: 30px;
        }
        .back-link a {
            color: #555; text-decoration: none; font-size: 0.9rem; transition: 0.3s;
        }
        .back-link a:hover { color: #00ffcc; text-shadow: 0 0 5px #00ffcc; }

        /* Scrollbar Customization */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0b0c10; }
        ::-webkit-scrollbar-thumb { background: #333; }
        ::-webkit-scrollbar-thumb:hover { background: #00ffcc; }

    </style>
</head>
<body>

<div class="container">
    <h2><i class="fas fa-gamepad"></i> FCN CHECK-IN</h2>

    <div class="user-select-container">
        <label><i class="fas fa-database"></i> LOAD PLAYER DATA</label>
        <select id="existingUser" onchange="fillData()">
            <option value="">[ SELECT EXISTING PROFILE ]</option>
            <option disabled>CONNECTING TO SERVER...</option>
        </select>
    </div>

    <form name="submit-to-google-sheet">
        <div class="form-group">
            <label>Nama </label>
            <input type="text" name="Nama" id="nama" placeholder="NAMA ASLI / PANGGILAN" required autocomplete="off">
        </div>
        
        <div class="form-group" style="display: flex; gap: 15px;">
            <div style="flex: 1;">
                <label>IGN (NICKNAME)</label>
                <input type="text" name="Nickname" id="nickname" placeholder="FCN Nickname" required autocomplete="off">
            </div>
            <div style="flex: 1;">
                <label>OpenID (PlayerID)</label>
                <input type="text" name="OpenID" id="openid" placeholder="123456789" required autocomplete="off">
            </div>
        </div>

        <div class="form-group">
            <label>NOMOR WHATSAPP</label>
            <input type="number" name="No WA" id="wa" placeholder="081xxxxx" required autocomplete="off">
        </div>

        <div class="form-group">
            <label>SERVER REGION (DOMISILI)</label>
            <select name="Domisili" id="provinsi" required>
                <option value="">[ SELECT LOCATION ]</option>
            </select>
        </div>

        <div class="form-group">
            <label>STATUS REPORT</label>
            <textarea name="Keterangan" placeholder="HADIR / IZIN / SAKIT / OUT CLAN"></textarea>
        </div>

        <button type="submit" id="btnKirim">DEPLOY DATA</button>
        <div class="loader" id="loader"><i class="fas fa-satellite-dish fa-spin"></i> UPLOADING TO MAINFRAME...</div>
    </form>
    
    <div class="back-link">
        <a href="/">&lt; RETURN TO LOBBY</a>
    </div>
</div>

<script>
    // --- SCRIPT LOGIC (TIDAK BERUBAH SECARA FUNGSIONAL) ---
    
    const scriptURL = 'https://script.google.com/macros/s/AKfycbw6xMH_uyUxvXjSt0cLBIUlgmjNx8u-xf4QMDoB4PHxZALBgqxpy6xw_pozzDd7M7iXmQ/exec';
    
    const form = document.forms['submit-to-google-sheet'];
    const btnKirim = document.getElementById('btnKirim');
    const loader = document.getElementById('loader');
    const existingUserSelect = document.getElementById('existingUser');

    // DATA PROVINSI
    const provinsiList = [
        "Aceh", "Sumatera Utara", "Sumatera Barat", "Riau", "Jambi", "Sumatera Selatan", "Bengkulu", "Lampung", "Kepulauan Bangka Belitung", "Kepulauan Riau",
        "DKI Jakarta", "Jawa Barat", "Jawa Tengah", "DI Yogyakarta", "Jawa Timur", "Banten",
        "Bali", "Nusa Tenggara Barat", "Nusa Tenggara Timur",
        "Kalimantan Barat", "Kalimantan Tengah", "Kalimantan Selatan", "Kalimantan Timur", "Kalimantan Utara",
        "Sulawesi Utara", "Sulawesi Tengah", "Sulawesi Selatan", "Sulawesi Tenggara", "Gorontalo", "Sulawesi Barat",
        "Maluku", "Maluku Utara", "Papua", "Papua Barat", "Papua Selatan", "Papua Tengah", "Papua Pegunungan", "Papua Barat Daya"
    ];

    const selectProv = document.getElementById('provinsi');
    provinsiList.forEach(prov => {
        let option = document.createElement('option');
        option.value = prov;
        option.text = prov.toUpperCase(); // Uppercase agar sesuai gaya
        selectProv.appendChild(option);
    });

    // LOAD USER LAMA
    let userData = {}; 

    fetch(scriptURL)
        .then(response => response.json())
        .then(users => {
            existingUserSelect.innerHTML = '<option value="">[ NEW RECRUIT / MANUAL INPUT ]</option>';
            
            if (users.length === 0) {
                 let option = document.createElement('option');
                 option.text = "NO DATA FOUND";
                 option.disabled = true;
                 existingUserSelect.appendChild(option);
            } else {
                users.forEach(user => {
                    let option = document.createElement('option');
                    option.value = user.openid; 
                    option.text = `[${user.nickname}] ${user.nama}`; // Format ala game
                    existingUserSelect.appendChild(option);
                    userData[user.openid] = user;
                });
            }
        })
        .catch(error => {
            console.error('Error loading users:', error);
            existingUserSelect.innerHTML = '<option disabled>SERVER ERROR</option>';
        });

    function fillData() {
        const selectedOpenID = existingUserSelect.value;
        if (selectedOpenID && userData[selectedOpenID]) {
            const data = userData[selectedOpenID];
            document.getElementById('nama').value = data.nama;
            document.getElementById('nickname').value = data.nickname;
            document.getElementById('openid').value = data.openid;
            document.getElementById('wa').value = data.wa;
            document.getElementById('provinsi').value = data.domisili;
        } else {
            form.reset();
        }
    }

    // KIRIM DATA
    form.addEventListener('submit', e => {
        e.preventDefault();
        btnKirim.disabled = true;
        btnKirim.innerHTML = "TRANSMITTING...";
        btnKirim.style.background = "#555"; // Visual feedback
        loader.style.display = "block";

        fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => {
                alert("✅ MISSION ACCOMPLISHED: Data Secured!");
                form.reset();
                existingUserSelect.value = ""; 
                btnKirim.disabled = false;
                btnKirim.innerHTML = "DEPLOY DATA";
                btnKirim.style.background = "#00ffcc";
                loader.style.display = "none";
            })
            .catch(error => {
                alert("❌ CONNECTION LOST: Check Internet.");
                console.error('Error!', error.message);
                btnKirim.disabled = false;
                btnKirim.innerHTML = "RETRY DEPLOY";
                loader.style.display = "none";
            });
    });
</script>

</body>
</html>
