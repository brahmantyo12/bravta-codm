<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATTENDANCE - FalconIDN Clan</title>
    <link rel="icon" href="favicon.png" type="image/x-icon">
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    
    <style>
        /* --- 1. CONFIG --- */
        :root {
            --mw-bg: #0a0a0a;
            --mw-panel: #141414;
            --mw-text: #cccccc;
            --mw-accent: #789f55; /* Hijau Militer */
            --mw-flash: #ffaa00;  /* Warna Kilatan Oranye Ledakan */
            --mw-border: #333333;
        }

        /* --- 2. GLOBAL STYLES & PASSIVE BATTLEFIELD EFFECTS --- */
        * { box-sizing: border-box; }
        
        body {
            background-color: var(--mw-bg);
            color: var(--mw-text);
            font-family: 'Roboto', sans-serif;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; padding: 20px;
            overflow-x: hidden; /* Mencegah scrollbar saat shake */
            position: relative;
        }

        /* EFEK PASIF 1: SCANLINES MONITOR BERGERAK */
        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 1px, transparent 1px, transparent 2px);
            pointer-events: none; z-index: 1;
            animation: scanlineMove 10s linear infinite;
            opacity: 0.3;
        }

        /* EFEK PASIF 2: NOISE/GRAIN TACTICAL OVERLAY */
        body::after {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            /* Data URI pattern noise sederhana */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            pointer-events: none; z-index: 2; opacity: 0.4;
        }

        /* --- 3. CONTAINER UTAMA --- */
        .container {
            background: var(--mw-panel);
            width: 100%; max-width: 500px; padding: 35px;
            border-top: 4px solid var(--mw-accent);
            border-bottom: 1px solid var(--mw-border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative; z-index: 10; /* Di atas efek background */
        }

        /* CLASS PEMICU EFEK MEDAN PERANG (Ditambahkan lewat JS saat submit) */
        .container.deploying {
            animation: rumble 0.5s cubic-bezier(.36,.07,.19,.97) both; /* Efek Getar */
        }
        
        /* EFEK KILATAN (MUZZLE FLASH) PADA CONTAINER */
        .container.deploying::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--mw-flash); /* Kilatan Oranye */
            mix-blend-mode: overlay; /* Menyatu dengan konten di bawahnya */
            pointer-events: none;
            animation: muzzle-flash 0.5s ease-out both;
        }

        /* --- KEYFRAMES ANIMASI (VFX) --- */
        /* Animasi Garis Scanline */
        @keyframes scanlineMove { from { background-position: 0 0; } to { background-position: 0 100%; } }

        /* Animasi Getaran (Screen Shake) yang Agresif */
        @keyframes rumble {
            10%, 90% { transform: translate3d(-3px, 0, 0) rotate(-1deg); }
            20%, 80% { transform: translate3d(5px, 0, 0) rotate(1deg); }
            30%, 50%, 70% { transform: translate3d(-6px, -2px, 0) rotate(-2deg); border-top-color: var(--mw-flash); }
            40%, 60% { transform: translate3d(6px, 2px, 0) rotate(2deg); }
        }

        /* Animasi Kilatan Cahaya */
        @keyframes muzzle-flash {
            0% { opacity: 0; }
            10% { opacity: 0.8; } /* Kilatan terang tiba-tiba */
            100% { opacity: 0; } /* Memudar cepat */
        }

        /* --- 4. TYPOGRAPHY & FORM ELEMENTS --- */
        h2 { 
            text-align: center; margin-bottom: 30px; 
            font-family: 'Roboto Condensed', sans-serif; font-weight: 700; font-size: 2rem; color: #ffffff; 
            text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid var(--mw-border); padding-bottom: 15px;
        }
        h2 i { color: var(--mw-accent); margin-right: 10px; }
        label { font-family: 'Roboto Condensed', sans-serif; font-size: 0.85rem; color: var(--mw-accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; display: block; font-weight: 700; }
        .form-group { margin-bottom: 20px; }
        .dual-column { display: flex; gap: 15px; }
        input, select, textarea { width: 100%; padding: 14px; background: #0f0f0f; border: 1px solid var(--mw-border); border-left: 3px solid var(--mw-border); color: #fff; font-family: 'Roboto', sans-serif; font-size: 1rem; transition: 0.2s; outline: none; border-radius: 0; }
        input:focus, select:focus, textarea:focus { border-color: #555; border-left-color: var(--mw-accent); background: #1a1a1a; }
        input::placeholder, textarea::placeholder { color: #555; font-style: italic; font-size: 0.9rem; }
        textarea { resize: vertical; height: 100px; }
        select { cursor: pointer; }
        button { width: 100%; padding: 16px; border: none; background: #252525; color: #ccc; font-family: 'Roboto Condensed', sans-serif; font-weight: 700; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; transition: 0.2s; margin-top: 10px; border-left: 4px solid #444; }
        button:hover { background: var(--mw-accent); color: #fff; border-left-color: #fff; transform: translateY(-2px); }
        button:disabled { background: #151515; color: #444; border-left-color: #222; cursor: not-allowed; transform: none; }
        .user-select-container { border: 1px solid var(--mw-border); background: rgba(255, 255, 255, 0.02); padding: 15px; margin-bottom: 25px; }
        .loader { display: none; text-align: center; margin-top: 15px; font-family: 'Roboto Condensed', sans-serif; font-size: 0.9rem; color: var(--mw-accent); letter-spacing: 1px; }
        .back-link { text-align: center; margin-top: 25px; }
        .back-link a { color: #666; text-decoration: none; font-size: 0.85rem; transition: 0.3s; font-family: 'Roboto Condensed', sans-serif; text-transform: uppercase; }
        .back-link a:hover { color: var(--mw-accent); }
        @media (max-width: 600px) { body { padding: 15px; } .container { padding: 25px 20px; } h2 { font-size: 1.6rem; margin-bottom: 20px; } input, select, textarea, button { font-size: 1rem; } .dual-column { flex-direction: column; gap: 20px; } button { padding: 18px; } }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <h2><i class="fas fa-square-full"></i> FCN CHECK-IN</h2>

    <div class="user-select-container">
        <label><i class="fas fa-database"></i> LOAD PLAYER DATA</label>
        <select id="existingUser" onchange="fillData()">
            <option value="">[ SELECT EXISTING PROFILE ]</option>
            <option disabled>CONNECTING TO SERVER...</option>
        </select>
    </div>

    <form name="submit-to-google-sheet">
        <div class="form-group">
            <label>NAMA</label>
            <input type="text" name="Nama" id="nama" placeholder="NAMA ASLI / PANGGILAN" required autocomplete="off">
        </div>
        
        <div class="form-group dual-column">
            <div style="flex: 1;">
                <label>IGN (NICKNAME)</label>
                <input type="text" name="Nickname" id="nickname" placeholder="FCN Nickname" required autocomplete="off">
            </div>
            <div style="flex: 1;">
                <label>OpenID (PlayerID)</label>
                <input type="number" name="OpenID" id="openid" placeholder="123456789" required autocomplete="off">
            </div>
        </div>

        <div class="form-group">
            <label>NOMOR WHATSAPP</label>
            <input type="number" name="No WA" id="wa" placeholder="081xxxxx" required autocomplete="off">
        </div>

        <div class="form-group">
            <label>SERVER REGION (DOMISILI)</label>
            <select name="Domisili" id="provinsi" required>
                <option value="">[ SELECT LOCATION ]</option>
            </select>
        </div>

        <div class="form-group">
            <label>STATUS REPORT</label>
            <textarea name="Keterangan" placeholder="HADIR / IZIN / SAKIT / OUT CLAN"></textarea>
        </div>

        <input type="text" name="honeypot" id="honeypot" style="display:none" autocomplete="off">

        <button type="submit" id="btnKirim">DEPLOY DATA</button>
        <div class="loader" id="loader"><i class="fas fa-radiation fa-spin"></i> TRANSMITTING DATA...</div>
    </form>
    
    <div class="back-link">
        <a href="/">&lt; RETURN TO MAIN MENU</a>
    </div>
</div>

<script>
    // --- SCRIPT LOGIC ---
    // URL Web App kamu sudah dimasukkan di sini:
    const scriptURL = 'https://script.google.com/macros/s/AKfycbymIg8Mo__BdudgTrKr2kuBP_77ilfXZjrqg6qdx88aVsqhLoZw2s6-Y2oESXuiUMLgGA/exec';
    
    const form = document.forms['submit-to-google-sheet'];
    const btnKirim = document.getElementById('btnKirim');
    const loader = document.getElementById('loader');
    const existingUserSelect = document.getElementById('existingUser');
    const mainContainer = document.getElementById('mainContainer');

    // DATA PROVINSI
    const provinsiList = ["Aceh", "Sumatera Utara", "Sumatera Barat", "Riau", "Jambi", "Sumatera Selatan", "Bengkulu", "Lampung", "Kepulauan Bangka Belitung", "Kepulauan Riau", "DKI Jakarta", "Jawa Barat", "Jawa Tengah", "DI Yogyakarta", "Jawa Timur", "Banten", "Bali", "Nusa Tenggara Barat", "Nusa Tenggara Timur", "Kalimantan Barat", "Kalimantan Tengah", "Kalimantan Selatan", "Kalimantan Timur", "Kalimantan Utara", "Sulawesi Utara", "Sulawesi Tengah", "Sulawesi Selatan", "Sulawesi Tenggara", "Gorontalo", "Sulawesi Barat", "Maluku", "Maluku Utara", "Papua", "Papua Barat", "Papua Selatan", "Papua Tengah", "Papua Pegunungan", "Papua Barat Daya"];
    const selectProv = document.getElementById('provinsi');
    provinsiList.forEach(prov => { let option = document.createElement('option'); option.value = prov; option.text = prov.toUpperCase(); selectProv.appendChild(option); });

    // LOAD USER DATA
    let userData = {}; 
    fetch(scriptURL)
        .then(response => response.json())
        .then(users => { 
            existingUserSelect.innerHTML = '<option value="">[ SELECT EXISTING PROFILE ]</option>'; 
            if (users.length === 0) { 
                let option = document.createElement('option'); option.text = "NO DATA FOUND"; option.disabled = true; existingUserSelect.appendChild(option); 
            } else { 
                users.forEach(user => { 
                    let option = document.createElement('option'); 
                    option.value = user.openid; 
                    option.text = `[${user.nickname}] ${user.nama}`; 
                    existingUserSelect.appendChild(option); 
                    userData[user.openid] = user; 
                }); 
            } 
        })
        .catch(error => { 
            console.error('Error loading users:', error); 
            existingUserSelect.innerHTML = '<option disabled>SERVER ERROR</option>'; 
        });

    // FUNGSI ISI OTOMATIS (AUTOFILL)
    function fillData() { 
        const selectedOpenID = existingUserSelect.value; 
        if (selectedOpenID && userData[selectedOpenID]) { 
            const data = userData[selectedOpenID]; 
            document.getElementById('nama').value = data.nama; 
            document.getElementById('nickname').value = data.nickname; 
            document.getElementById('openid').value = data.openid; 
            document.getElementById('provinsi').value = data.domisili; 
            
            // SECURITY 3: PRIVASI WA
            // Kita kosongkan kolom WA agar user mengisi manual (tidak terekspos dari server)
            document.getElementById('wa').value = ""; 
            document.getElementById('wa').placeholder = "Isi ulang demi privasi...";
        } else { 
            form.reset(); 
            document.getElementById('wa').placeholder = "081xxxxx";
        } 
    }

    // --- LOGIKA PENGIRIMAN DENGAN EFEK VISUAL ---
    form.addEventListener('submit', e => {
        e.preventDefault();
        
        // 1. AKTIFKAN EFEK MEDAN PERANG
        mainContainer.classList.add('deploying');
        setTimeout(() => { mainContainer.classList.remove('deploying'); }, 500);

        // 2. PROSES PENGIRIMAN
        btnKirim.disabled = true;
        btnKirim.innerHTML = "TRANSMITTING...";
        btnKirim.style.background = "#151515"; 
        btnKirim.style.borderLeftColor = "#333";
        btnKirim.style.color = "#555";
        loader.style.display = "block";

        fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => {
                alert("✅ MISSION ACCOMPLISHED: Data Secured!");
                form.reset();
                existingUserSelect.value = ""; 
                btnKirim.disabled = false;
                btnKirim.innerHTML = "DEPLOY DATA";
                btnKirim.removeAttribute("style");
                loader.style.display = "none";
                document.getElementById('wa').placeholder = "081xxxxx"; // Reset placeholder
            })
            .catch(error => {
                alert("❌ CONNECTION LOST: Check Internet.");
                console.error('Error!', error.message);
                btnKirim.disabled = false;
                btnKirim.innerHTML = "RETRY DEPLOY";
                loader.style.display = "none";
            });
    });
</script>

</body>
</html>
